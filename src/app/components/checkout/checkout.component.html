<app-navbar></app-navbar>

<br />
<div class="cart">
  <h2>Resumen de Su Compra</h2>
  <ul class="cart-items">
    <li class="cart-item" *ngFor="let item of cartItems">
      <div class="item-details">
        <img
          [src]="item.productPathImage"
          alt="Product Image"
          class="product-image"
        />
        <div class="item-info">
          <h3 class="product-name">{{ item.productName }}</h3>
          <p class="product-price">
            Precio: {{ item.productPrice | currency }}
          </p>
          <p class="product-quantity">Cantidad: {{ item.productQuantity }}</p>
        </div>
      </div>
    </li>
  </ul>
  <h5 class="total">
    Total: <span class="total-price">{{ totalPrice | currency }}</span>
  </h5>

  <h2>Información de Envío</h2>
  <br />

  <!-- Selector de direcciones -->
  <div *ngIf="!addingNewAddress" class="form-container">
    <form>
      <label for="savedAddresses">Elegir dirección</label><br />
      <select [(ngModel)]="selectedAddress" name="savedAddresses">
        <option *ngFor="let address of savedAddresses" [value]="address">
          {{ address }}
        </option>
      </select>
      <br />
      <button
        class="btn-success"
        (click)="showNewAddressForm()"
        style="margin-left: 0%"
      >
        Agregar Nueva Dirección
      </button>
    </form>
  </div>

  <!-- Formulario de nueva dirección -->
  <div *ngIf="addingNewAddress" class="form-container">
    <form>
      <label for="address">Dirección:</label>
      <input
        type="text"
        id="address"
        [(ngModel)]="address"
        name="address"
        required
      />
      <label for="phone">Teléfono:</label>
      <input type="text" id="phone" [(ngModel)]="phone" name="phone" required />
      <br />
      <button class="btn-success" (click)="hideNewAddressForm()">
        Usar Dirección Guardada
      </button>
    </form>
  </div>
  <br />
  <h2>Datos de Pago</h2>

  <!-- Selector de tarjetas -->
  <div *ngIf="!addingNewCard" class="form-container">
    <form>
      <label for="savedCards">Tarjeta Guardada:</label><br />
      <select id="savedCards" [(ngModel)]="selectedCard" name="savedCards">
        <option *ngFor="let card of savedCards" [value]="card">
          {{ card }}
        </option>
      </select>
      <br />
      <button class="btn-success" (click)="showNewCardForm()">
        Agregar Nueva Tarjeta
      </button>
    </form>
  </div>

  <!-- Formulario de nueva tarjeta -->
  <div *ngIf="addingNewCard" class="form-container">
    <form>
      <label for="cardNumber">Número de Tarjeta:</label>
      <input
        type="text"
        id="cardNumber"
        [(ngModel)]="cardNumber"
        name="cardNumber"
        required
      />
      <label for="cardName">Nombre del Titular:</label>
      <input
        type="text"
        id="cardName"
        [(ngModel)]="cardName"
        name="cardName"
        required
      />
      <label for="cardExpiration">Fecha de Vencimiento:</label>
      <input
        type="date"
        id="cardExpiration"
        [(ngModel)]="cardExpiration"
        name="cardExpiration"
        required
      />
      <label for="cardCvv">CVV:</label>
      <input
        type="text"
        id="cardCvv"
        [(ngModel)]="cardCvv"
        name="cardCvv"
        required
      />
      <label for="cardType">Tipo de Tarjeta:</label>
      <select [(ngModel)]="cardType" name="cardType">
        <option value="Debit">Débito</option>
        <option value="Credit">Crédito</option>
        <option value="Paypal">Paypal</option>
        <option value="Other">Otro</option>
      </select>
      <br />
      <button class="btn-success" (click)="hideNewCardForm()">
        Usar Tarjeta Guardada
      </button>
    </form>
  </div>
  <br />
  <button
    class="btn-success"
    (click)="processCheckout()"
    style="margin-left: 40%"
  >
    Realizar pedido
  </button>
</div>

<div *ngIf="loading">
  <app-spinner></app-spinner>
</div>
